#summary How to configure RFXcmd with WeeWx

= Introduction =

The Weewx is an python application with webpage that collects data from several weather stations and present them graphically on the webpage. The Weewx extension to RFXcmd will make it possible to forward data received from RFX device to Weewx for presentation.

The first version of the Weewx RFXcmd driver was made by M.Bakker, the driver has been extended and modified for more specific configuration.

= Details =

The normal operation of Weewx is that it listens to the physical weather station, usually via USB, and takes the data and stores it in database. This require little bit different process for RFXcmd as it already listens to the RFX device for all the data.

The flow of information is following. RFXcmd listens to the RFX device, when a sensor output data, RFXcmd will check if this sensor is accepted for Weewx. If it is, then the data will be saved in variables. The Weewx in turn will request data from RFXcmd in intervals (default 60sec) and RFXcmd will send the data from the variables.

= Limitations =

The current approach do have some limitations. With the weewx configuration the user can define which specific sensor should be used for which data, but, if the user have two sensors of the same type, then these can not be separated because the Weewx does not recognize sensor id or type.

The RFXcmd weewx configuration can be specified which sensors are not allowed to share the data with Weewx.

= Files =

There are two files needed by the Weewx in the RFXcmd directory 'weewx'.

The 'rfxcmd_weewx_config.txt' is the configuration part that should be copy/pasted in to the weewx configuration file (see below for more info).

The 'rfxcmd_weewx.py' is the driver file for weewx and should be copied to the driver directory in weewx, '/usr/share/weewx/weewx/drivers' and renamed to 'rfxcmd.py'.

= Sensors =

These are the sensors that are supported to be used with weewx.

||Sensor type||Description||
||0x4f||Temperature and rain sensors||
||0x50||Temperature sensors||
||0x51||Humidity sensors||
||0x52||Temperature and humidity sensors||
||0x53||Barometric sensors (Not currently supported by RFX device)||
||0x54||Temperature, humidity and barometric sensors||
||0x55||Rain sensors||
||0x56||Wind sensors||
||0x57||UV sensors||

= RFXcmd configuration =

== config.xml ==

The RFXcmd configuration file (config.xml) have two xml tags that are related to the Weewx usage.

<weewx_active>

Should be set to 'yes' if the Weewx sharing is wanted. Default 'no'

<weewx_config>

The name of the Weewx accepted sensors. Default 'weewx.xml'.

Example:

{{{
	<!-- Weewx -->
	<weewx_active>no</weewx_active>          
	<weewx_config>weewx.xml</weewx_config>
}}}

Any changes in the config.xml will be activated when rfxcmd is restarted.

== weewx.xml == 

The weewx.xml file contains the sensors that are allowed to share the data to weewx requests. This is needed when you have several sensors with the same type and just want to use one of them for weewx data.

{{{
<xml>
<sensor>
	<type>5202</type>
	<id>1500</id>
</sensor>
<sensor>
	<type>5402</type>
	<id>1E00</id>
</sensor>
<sensor>
	<type>5402</type>
	<id>2301</id>
</sensor>
</xml>
}}}

Any changes in the weewx.xml will be activated when rfxcmd is restarted.

= Weewx configuration =

The Weewx main configuration file can be found at /etc/weewx/weewx.config

The most important settings detailed below.

=== Socket server ===

This specifies the information about the RFXcmd socket server. If there is issues with the communication there will be error events in the syslog.

{{{
    # RFXcmd Socket server
    socket_server = localhost
    socket_port = 55000
}}}

=== Logging ===

For troubleshooting this should be set to 'True' and will create a detailed logfile in the 'logfile' location. It is not recommended to have this activated in normal usage as it can create quite large logfile.

{{{
    # Debug
    debug = True
    logfile = "/tmp/weewx_rfxcmd.log"
}}}

=== Sensors ===

The list of the sensors that Weewx will request data for, set the sensor to 'True' for Weewx to request data.

{{{
    # RFX Sensors
    sensor_0x4F = False
    sensor_0x50 = False
    sensor_0x51 = False
    sensor_0x52 = False
    sensor_0x53 = False
    sensor_0x54 = False
    sensor_0x55 = False
    sensor_0x56 = False
    sensor_0x57 = False
}}}

=== Sensor config ===

Sensor conifguration, each sensor have their data set, and with this configuration it can be chosen where the data should be stored in the Weewx database. The variable list can be found below of all Weewx variables that can be used. An empty variable will not be used.

{{{
    # 0x52 Temp/Baro Sensors
    sensor_0x52_temp = "outTemp"
    sensor_0x52_hum = "outHumidity"
    sensor_0x52_batt = ""
    sensor_0x52_rssi = ""
}}}

== Example configuration ==
{{{
##############################################################################

[RfxCmd]

    # This section is for the RFXCMD

    # The model is RFXCMD
    model = RfxCmd

    # Do not know
    mode = socket

    # RFXcmd Socket server
    socket_server = localhost
    socket_port = 55000

    # Debug
    debug = True
    logfile = "/tmp/weewx_rfxcmd.log"

    # RFX Sensors
    sensor_0x4F = False
    sensor_0x50 = False
    sensor_0x51 = False
    sensor_0x52 = False
    sensor_0x53 = False
    sensor_0x54 = False
    sensor_0x55 = False
    sensor_0x56 = False
    sensor_0x57 = False

	# 0x4F Temp and Rain sensors
    sensor_0x4F_temp = "outTemp"
    sensor_0x4F_raintotal = "totalRain"
    sensor_0x4F_batt = ""
    sensor_0x4F_rssi = ""
	
    # 0x50 Temperature Sensors
    sensor_0x50_temp = "inTemp"
    sensor_0x50_batt = ""
    sensor_0x50_rssi = ""

    # 0x51 Humidity Sensors
    sensor_0x51_hum = "outHumidity"
    sensor_0x51_batt = ""
    sensor_0x51_rssi = ""

    # 0x52 Temp/Hum Sensors
    sensor_0x52_temp = "outTemp"
    sensor_0x52_hum = "outHumidity"
    sensor_0x52_batt = ""
    sensor_0x52_rssi = ""
    
    # 0x53 Barometric Sensors
    sensor_0x53_baro = "barometer"
    sensor_0x53_batt = ""
    sensor_0x53_rssi = ""
    
    # 0x54 Temp/Hum/Baro Sensors
    sensor_0x54_temp = "outTemp"
    sensor_0x54_hum = "outHumidity"
    sensor_0x54_baro = "barometer"
    sensor_0x54_batt = ""
    sensor_0x54_rssi = ""

    # 0x55 Rain Sensors
    sensor_0x55_rainrate = "rain"
    sensor_0x55_raintotal = "totalRain"
    sensor_0x55_batt = ""
    sensor_0x55_rssi = ""
    
    # 0x56 Wind Sensors
    sensor_0x56_direction = "windDir"
    sensor_0x56_avspeed = "windSpeed"
    sensor_0x56_gust = "windGust"
    sensor_0x56_temp = "outTemp"
    sensor_0x56_chill = ""
    sensor_0x56_batt = ""
    sensor_0x56_rssi = ""
    
    # 0x57 UV Sensors
    sensor_0x57_uv = "UV"
    sensor_0x57_temp = "extraTemp1"
    sensor_0x57_batt = ""
    sensor_0x57_rssi = ""

    # The driver to use
    driver = weewx.drivers.rfxcmd

##############################################################################
}}}

= Available Weewx variables =

These are used in the Weewx config file to specify which sensor data should be used (see config info).

||Variable||Group||
||altitude||group_altitude||
||cooldeg||group_degree_day||
||heatdeg||group_degree_day||
||gustdir||group_direction||
||vecdir||group_direction||
||windDir||group_direction||
||windGustDir||group_direction||
||interval||group_interval||
||soilMoist1||group_moisture||
||soilMoist2||group_moisture||
||soilMoist3||group_moisture||
||soilMoist4||group_moisture||
||extraHumid1||group_percent||
||extraHumid2||group_percent||
||inHumidity||group_percent||
||outHumidity||group_percent||
||rxCheckPercent||group_percent||
||altimeter||group_pressure||
||barometer||group_pressure||
||pressure||group_pressure||
||radiation||group_radiation||
||ET||group_rain||
||dayRain||group_rain||
||hail||group_rain||
||hourRain||group_rain||
||monthRain||group_rain||
||rain||group_rain||
||rain24||group_rain||
||totalRain||group_rain||
||stormRain||group_rain||
||yearRain||group_rain||
||hailRate||group_rainrate||
||rainRate||group_rainrate||
||wind||group_speed||
||windGust||group_speed||
||windSpeed||group_speed||
||windSpeed10||group_speed||
||windgustvec||group_speed||
||windvec||group_speed||
||rms||group_speed2||
||vecavg||group_speed2||
||dewpoint||group_temperature||
||extraTemp1||group_temperature||
||extraTemp2||group_temperature||
||extraTemp3||group_temperature||
||heatindex||group_temperature||
||heatingTemp||group_temperature||
||inTemp||group_temperature||
||leafTemp1||group_temperature||
||leafTemp2||group_temperature||
||outTemp||group_temperature||
||soilTemp1||group_temperature||
||soilTemp2||group_temperature||
||soilTemp3||group_temperature||
||soilTemp4||group_temperature||
||windchill||group_temperature||
||dateTime||group_time||
||UV||group_uv||
||consBatteryVoltage||group_volt||
||heatingVoltage||group_volt||
||referenceVoltage||group_volt||
||supplyVoltage||group_volt||