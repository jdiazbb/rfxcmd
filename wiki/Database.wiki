#summary A generalized database table for all sensor data

= Introduction =

Generalized database structure for all sensors from RFX, for both Mysql and Sqlite. Other databases can be added as well.

This will not work with RFXCMD version 0.2x and lower, this will be implemented in RFXCMD 0.3x

= Version =

||Version||Date||Info||
||PA1||1-DEC-2012||First version||

= Details =

=== Common ===

The fields that all sensors have common:

||DB||id||Datetime||Packettype||Subtype||Seqnbr||Battery||Signal||Processed||
||MySQL||integer(11)||Datetime||varchar(2)||varchar(2)||varchar(2)||integer(2)||integer(2)||integer(1)||
||Sqlite||integer||text||text||text||text||integer||integer||integer||

Notes

 * Battery/Signal, If no battery or signal value, then it will be 255
 * Processed, used to mark data processed, example when reading data to RRD

=== Sensor ===

Sensor specific data fields:

|| ||data1||data2||data3||data4||data5||data6||data7||data8||data9||data10||data11||data12||data13||
||MySQL||varchar(32)||varchar(2)||varchar(2)||integer||integer||integer||integer||float||float||float||float||float||datetime||
||Sqlite||text||text||text||integer||integer||integer||integer||real||real||real||real||real||text||
||0x01||cmnd||msg1||-||msg2||msg3||msg4||msg5||-||-||-||-||-||-||
||0x02||msg||-||-||-||-||-||-||-||-||-||-||-||-||
||0x03||msg1-msg33||-||-||-||-||-||-||-||-||-||-||-||-||
||0x10||housecode||-||cmnd||unitcode||-||-||-||-||-||-||-||-||-||
||0x11||id1-id4||-||cmnd||unitcode||dimlevel||-||-||-||-||-||-||-||-||
||0x12||system||-||cmnd||channel||-||-||-||-||-||-||-||-||-||
||0x13||-||-||-||cmd1-3||pulse||-||-||-||-||-||-||-||-||
||0x14||id1-id3||-||cmnd||unitcode||-||-||-||-||-||-||-||-||-||
||0x15||id1-id2||groupcode||cmnd||unitcode||cmndseqnbr||-||-||-||-||-||-||-||-||
||0x18||housecode||-||cmnd||unitcode||-||-||-||-||-||-||-||-||-||
||0x19||id1-id3||-||cmnd||unitcode||-||-||-||-||-||-||-||-||-||
||0x20||id1-id3||status||-||-||-||-||-||-||-||-||-||-||-||
||0x28||housecode||-||cmnd||-||-||-||-||-||-||-||-||-||-||
||0x30||id||-||cmnd||toggle||cmndtype||-||-||-||-||-||-||-||-||
||0x40||id1-id2||-||-||-||set_point||mode||status||temperature||-||-||-||-||-||
||0x41||unitcode||-||cmnd||-||-||-||-||-||-||-||-||-||-||
||0x42||unitcode1-3||-||cmnd||-||-||-||-||-||-||-||-||-||-||
||0x50||id1-id2||-||-||-||-||-||-||temperature||-||-||-||-||-||
||0x51||id1-id2||-||-||humidity||humidity status||-||-||-||-||-||-||-||-||
||0x52||id1-id2||-||-||humidity||humidity status||-||-||temperature||-||-||-||-||-||
||0x53||id1-id2||-||-||-||-||barometric||forecast||-||-||-||-||-||-||
||0x54||id1-id2||-||-||humidity||humidity status||barometric||forecast||temperature||-||-||-||-||-||
||0x55||id1-id2||-||-||-||-||-||-||rainrate||raintotal||-||-||-||-||
||0x56||id1-id2||-||-||-||-||-||-||temperature||av_speed||gust||direction||chill||-||
||0x57||id1-id2||-||-||uv||-||-||-||temperature||-||-||-||-||-||
||0x58||id1-id2||-||-||-||-||-||-||-||-||-||-||-||datetime||
||0x59||id1-id2||-||-||count||-||-||-||ch1||ch2||ch3||-||-||-||
||0x5A||id1-id2||-||-||packetcount||-||-||-||instant||-||-||total||-||-||
||0x5B||id1-id2||-||-||count||-||-||-||ch1||ch2||ch3||total||-||-||
||0x5D||id1-id2||-||-||-||-||-||-||weight||-||-||-||-||-||
||0x5E||reserved||-||-||-||-||-||-||-||-||-||-||-||-||
||0x5F||reserved||-||-||-||-||-||-||-||-||-||-||-||-||
||0x70||id||msg1||msg2||-||-||-||voltage||temperature||-||-||-||-||-||
||0x71||id1-id2||count3||count4||count2||count1||-||-||-||-||-||-||-||-||
||0x72||housecode||group address||sub address||cmd1_hi||cmd1_lo||-||-||cmd2||-||-||-||-||-||
||0x80||not implemented||-||-||-||-||-||-||-||-||-||-||-||-||

= MySQL =

{{{
Coming soon....
}}}

= Sqlite =

Sqlite is a lightweight open source database. For easy management via web interface the [http://code.google.com/p/phpliteadmin/ phpliteadmin] can be used.

=== Create database ===

At the command prompt;

{{{
$ sqlite3 database.sqlite
}}}

At the sqlite command prompt, list the database and then quit

{{{
sqlite> .databases
sqlite> .quit
}}}

Now the database file should have been created

Example:

{{{
$sqlite3 database.sqlite
SQLite version 3.7.12 2012-04-03 19:43:07
Enter ".help" for instructions
Enter SQL statements terminated with a ";"
sqlite> .databases
seq  name             file                                                      
---  ---------------  ----------------------------------------------------------
0    main             /temp/database.sqlite
sqlite> .quit
$ ls -la database.sqlite 
-rw-r--r--  1 user  staff  0 Nov 28 20:36 database.sqlite
$
}}}


=== Create table ===

In the RFXCMD there is a text file called 'rfxcmd_sqlite.txt' which contains the table setup for Sqlite. To create the table, it can be imported directly from the file, from the Sqlite shell.

Example;

{{{
sqlite> .read rfxcmd_sqlite.txt
sqlite> .tables
rfxcmd
sqlite> .schema rfxcmd
CREATE TABLE 'rfxcmd' (
'id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 
'datetime' TEXT, 
'packettype' INTEGER, 
'subtype' INTEGER, 
'seqnbr' INTEGER, 
'battery' INTEGER, 
'signal' INTEGER, 
'processed' INTEGER, 
'data1' INTEGER, 
'data2' INTEGER, 
'data3' INTEGER, 
'data4' INTEGER, 
'data5' INTEGER, 
'data6' INTEGER, 
'data7' INTEGER, 
'data8' REAL, 
'data9' REAL, 
'data10' REAL, 
'data11' REAL, 
'data12' REAL, 
'data13' INTEGER);
sqlite>
}}}

Now the Sqlite database is ready to use.

=== Configuration in RFXCMD ===

To be able to insert data from RFXCMD, the Sqlite has to be configured in the RFXCMD config file, config.xml. There are two XML tags that needs to be filled.

<sqlite_database> and <sqlite_table>

If using the same parameters as the example above, the settings would be following

{{{
<sqlite_database>/temp/database.sqlite</sqlite_database>
<sqlite_table>rfxcmd</sqlite_table>
}}}

Done.